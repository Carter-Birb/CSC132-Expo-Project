<!DOCTYPE html>
<html>
<head>
    <title>Face Tracker</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: row;
            height: 100vh; /* Ensure full height for the body */
        }

        #video-container {
            flex: 1;
            position: relative;
            width: 100%;  /* Ensure the container takes full width */
            height: 100%; /* Ensure the container takes full height */
        }

        #video-feed {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ensures the video is fully contained within the container */
        }

        #settings {
            width: 300px;
            background: #f0f0f0;
            padding: 20px;
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            transform: translateX(100%);
            transition: transform 0.4s ease;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            z-index: 1001;
        }

        #settings.open {
            transform: translateX(0%);
        }

        .toggle-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1002;
            padding: 12px 18px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .quit-btn {
            position: absolute;
            bottom: 75px; /* Adjusted to appear above the settings button */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1002;
            padding: 12px 18px;
            background: #FF0000; /* Red background */
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .quit-btn:hover {
            background: #CC0000; /* Darker red on hover */
        }

        label {
            display: block;
            margin: 20px 0 10px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
        }

        .slider-value {
            text-align: right;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <img src="{{ url_for('video_feed') }}" id="video-feed">
        <button class="toggle-btn" onclick="toggleSettings()">âš™ Settings</button>
        <button class="quit-btn" onclick="quitApplication()">Quit</button>
    </div>

    <div id="settings">
        <h3>Settings</h3>
        <form id="settings-form">
            <label>
                <input type="checkbox" name="flip" checked> Flip Camera
            </label>

            <label for="max_distance">Max Distance</label>
            <input type="range" id="max_distance" name="max_distance" min="30" max="200" value="50">
            <div class="slider-value"><span id="distance-value">50</span> px</div>
        </form>
    </div>

    <script>
        const form = document.getElementById("settings-form");
        const settingsPanel = document.getElementById("settings");
        const distanceSlider = document.getElementById("max_distance");
        const distanceValue = document.getElementById("distance-value");

        function toggleSettings() {
            settingsPanel.classList.toggle("open");
        }

        form.addEventListener("input", () => {
            const formData = new FormData(form);
            formData.set("flip", formData.get("flip") === "on");

            fetch("/set_config", {
                method: "POST",
                body: formData
            });

            distanceValue.textContent = distanceSlider.value;
        });

        function quitApplication() {
            if (confirm("Are you sure you want to quit?")) {
                const formData = new FormData();
                formData.append("quit", "true");

                fetch("/set_config", {
                    method: "POST",
                    body: formData
                })
                .then(response => {
                    if (response.ok) {
                        console.log("Server shutting down...");
                        window.close(); // Attempt to close the browser window
                    } else {
                        console.error("Failed to shut down the server.");
                    }
                })
                .catch(err => console.error("Error sending quit request:", err));
            }
        }
    </script>
</body>
</html>